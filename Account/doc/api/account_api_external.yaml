swagger: '2.0'

info:
  title: 'Digital Health Revolution - MyData Account'
  description:
    ' #### MyData-SDK - MyData Account API - External '
  version: '1.3'
  contact:
    url: 'https://github.com/HIIT/mydata-stack'
  license:
    name: 'MIT License (MIT)'
    url: 'https://opensource.org/licenses/MIT'

schemes:
  - https

basePath: '/account/api/v1.3/external/'

consumes:
  - application/json

produces:
  - application/json

securityDefinitions:
  externalApiKeyAuth:
    type: apiKey
    name: Api-Key-User
    in: header
    description: Authentication using apiKey for external use

  BasicAuth:
    type: basic
    description: HTTP Basic Auth

externalDocs:
  description: 'External documentation'
  url: 'https://github.com/HIIT/mydata-stack'

paths:

  /auth/user/:
    get:
      security:
        - BasicAuth: []
      summary: 'Get ApiKey for account'

      tags:
        - Auth

      responses:
        '200':
          description: ApiKey for authenticated user
          schema:
            $ref: '#/definitions/apiKeyResponse'
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server error
          schema:
            $ref: '#/definitions/errors'


  /accounts/:
    post:
      summary: 'Create new MyData Account'

      parameters:
        - name: newAccount
          in: body
          description: 'Base information for account'
          required: true
          schema:
            $ref: '#/definitions/newAccountRequest'

      tags:
        - Account

      responses:
        '201':
          description: Account created
          schema:
            $ref: '#/definitions/newAccountResponse'
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/:
    get:
      security:
        - externalApiKeyAuth: []
      summary: 'Fetch MyData Account by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true

      tags:
        - Account

      responses:
        '200':
          description: Account fetched
          schema:
            $ref: '#/definitions/accountResponse'
        '204':
          description: No Account with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'
    delete:
      security:
        - externalApiKeyAuth: []
      summary: 'Remove MyData Account by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true

      tags:
        - Account

      responses:
        '204':
          description: Account deleted
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/info/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch Account Info Object'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true

      tags:
        - Info

      responses:
        '200':
          description: Account Info fetched
          schema:
            $ref: '#/definitions/AccountInfoResponseArray'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/info/{info_id}/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch Account info object by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: info_id
          in: path
          type: integer
          description: 'Account Info ID'
          required: true

      tags:
        - Info

      responses:
        '200':
          description: Account info fetched
          schema:
            $ref: '#/definitions/AccountInfoResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'

    patch:
      security:
        - externalApiKeyAuth: []
      description: 'Update particulars'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: info_id
          in: path
          type: integer
          description: 'Account Info ID'
          required: true
        - name: payload
          in: body
          description: 'Resource content'
          required: true
          schema:
            $ref: '#/definitions/AccountInfoRequest'

      tags:
        - Info

      responses:
        '200':
          description: Account Info updated
          schema:
            $ref: '#/definitions/AccountInfoResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'




  /accounts/{account_id}/servicelinks/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch list of Service links related to Account'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true

      tags:
        - MyData Service Link

      responses:
        '200':
          description: Service link fetched
          schema:
            $ref: '#/definitions/serviceLinksResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch Service Link by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true

      tags:
        - MyData Service Link

      responses:
        '200':
          description: Service link fetched
          schema:
            $ref: '#/definitions/serviceLinkResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/statuses/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch list of Service Link statuses'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true

      tags:
        - MyData Service Link

      responses:
        '200':
          description: List of Service Link statuses fetched
          schema:
            $ref: '#/definitions/serviceLinkStatusesResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/statuses/{status_id}/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch Service Link status by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true
        - name: status_id
          in: path
          type: integer
          description: 'Service link status ID'
          required: true

      tags:
        - MyData Service Link

      responses:
        '200':
          description: Service link status fetched
          schema:
            $ref: '#/definitions/serviceLinkStatusResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/consents/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch list of Consents related to servicelink'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true

      tags:
        - MyData Consent

      responses:
        '200':
          description: List of Consents related to servicelink fetched
          schema:
            $ref: '#/definitions/consentsResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/consents/{consent_id}/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch Consent by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true
        - name: consent_id
          in: path
          type: integer
          description: 'Consent ID'
          required: true

      tags:
        - MyData Consent

      responses:
        '200':
          description: Consent fetched
          schema:
            $ref: '#/definitions/consentResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/consents/{consent_id}/statuses/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch list of Consent statuses'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true
        - name: consent_id
          in: path
          type: integer
          description: 'Consent ID'
          required: true

      tags:
        - MyData Consent

      responses:
        '200':
          description: List of Consent statuses fetched
          schema:
            $ref: '#/definitions/consentStatusesResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'


  /accounts/{account_id}/servicelinks/{servicelink_id}/consents/{consent_id}/statuses/{status_id}/:
    get:
      security:
        - externalApiKeyAuth: []
      description: 'Fetch Consent by ID'

      parameters:
        - name: account_id
          in: path
          type: integer
          description: 'Account ID'
          required: true
        - name: servicelink_id
          in: path
          type: integer
          description: 'Service link ID'
          required: true
        - name: consent_id
          in: path
          type: integer
          description: 'Consent ID'
          required: true
        - name: status_id
          in: path
          type: integer
          description: 'Status ID'
          required: true

      tags:
        - MyData Consent

      responses:
        '200':
          description: Consent fetched
          schema:
            $ref: '#/definitions/consentStatusResponse'
        '204':
          description: No content with given id
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/errors'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/errors'
        '403':
          description: Forbidden
          schema:
            $ref: '#/definitions/errors'
        '500':
          description: Internal Server errors
          schema:
            $ref: '#/definitions/errors'
        '503':
          description: Service Unavailable
          schema:
            $ref: '#/definitions/errors'



definitions:

  errors:
    type: object
    properties:
      status:
        type: string
        description: HTTP status code as string value.
      code:
        type: integer
        description: HTTP status code
      title:
        type: string
        description: Title of error message.
      detail:
        type: string
        description: Detailed error message.
      source:
        type: string
        description: Source URI

  apiKeyResponse:
    type: object
    properties:
      Api-Key:
        type: string
        description: ApiKey
      account_id:
        type: string
        description: Account ID

  newAccount:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'Account'
      attributes:
        type: object
        properties:
          username:
            type: string
            description: Account username
            maxLength: 255
          password:
            type: string
            format: password
            description: Account password
            maxLength: 255
            minLength: 8
          firstName:
            type: string
            description: User's first name
            maxLength: 255
          lastName:
            type: string
            description: User's last name
            maxLength: 255

  createdAccount:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'Account'
      id:
        type: integer
        description: Account ID
      attributes:
        type: object
        properties:
          activated:
            type: integer

  account:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'Account'
      id:
        type: integer
        description: Account ID
      attributes:
        type: object

  AccountInfo:
    type: object
    description: "Account info"
    properties:
      type:
        type: string
        description: Resource type 'AccountInfo'
      id:
        type: integer
        description: AccountInfo ID
      attributes:
        type: object
        properties:
          firstName:
            type: string
            description: First name
          lastName:
            type: string
            description: Last name
          avatar:
            type: string
            description: 'Base64 avatar image'

  newAccountRequest:
    type: object
    properties:
      data:
        $ref: '#/definitions/newAccount'

  newAccountResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/createdAccount'

  accountResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/account'


  AccountInfoResponseArray:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/AccountInfo'


  AccountInfoResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/AccountInfo'


  AccountInfoRequest:
    type: object
    properties:
      data:
        $ref: '#/definitions/AccountInfo'

  serviceLink:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'ServiceLink'
      id:
        type: integer
        description: Service Link ID
      attributes:
        type: object
        properties:
          serviceLinkRecordId:
            type: string
            description: 'Service Link Record ID'
          serviceId:
            type: string
            description: 'Related Service ID'
          surrogateId:
            type: string
            description: 'Related Surrogate ID'
          serviceLinkRecord:
            type: object
            description: 'Service Link Record as JWS - [MyData Service Linking Specification] (https://github.com/HIIT/mydata-stack)'


  serviceLinksResponse:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/serviceLink'


  serviceLinkResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/serviceLink'


  serviceLinkStatus:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'ServiceLinkStatus'
      id:
        type: integer
        description: Service Link Status Record ID
      attributes:
        type: object
        properties:
          status:
            type: string
            description: "Service Link's status"
          serviceLinkStatusRecord:
            type: object
            description: 'Service Link Status Record as JWS - [MyData Service Linking Specification] (https://github.com/HIIT/mydata-stack)'


  serviceLinkStatusesResponse:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/serviceLinkStatus'


  serviceLinkStatusResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/serviceLinkStatus'


  consent:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'Consent'
      id:
        type: integer
        description: Consent ID
      attributes:
        type: object
        properties:
          serviceLinkRecordId:
            type: string
            description: 'Related Service Record ID'
          serviceId:
            type: string
            description: 'Related Service ID'
          surrogateId:
            type: string
            description: 'Related Surrogate ID'
          consentRecordId:
            type: string
            description: 'Consent Record ID'
          consentRecord:
            type: object
            description: 'Consent Record as JWS - [MyData Authorization Specification] (https://github.com/HIIT/mydata-stack)'


  consentsResponse:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/consent'


  consentResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/consent'


  consentStatus:
    type: object
    properties:
      type:
        type: string
        description: Resource type 'ConsentStatus'
      id:
        type: integer
        description: Consent Status ID
      attributes:
        type: object
        properties:
          status:
            type: string
            description: "Consent's status"
          consentStatusRecord:
            type: object
            description: 'Consent Status Record as JWS - [MyData Authorization Specification] (https://github.com/HIIT/mydata-stack)'


  consentStatusesResponse:
    type: object
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/consentStatus'


  consentStatusResponse:
    type: object
    properties:
      data:
        $ref: '#/definitions/consentStatus'

